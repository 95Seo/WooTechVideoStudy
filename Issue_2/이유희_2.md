https://medium.com/@bnm1128/java%EC%9D%98-garbage-collector-649ff95ec38d

## Java의 Garbage Collector
Carbage Collector는 메모리에 할당된 영역 중 사용하지 않는 영역을 찾아내고 해제해 주는 역할을 수행한다.


GC를 이해하기 위해서는 OS에서 할당받은 JVM의 메모리 영역을 알아야 한다. JVM은 메모리 영역을 세 영역으로 구분한다. Method Area, Heap Area, JVM Stack이다.

메서드 영역에는 바이트 코드가 저장이 되며 모든 스레드가 공유한다. 메서드를 호출하면 스택 프레임이 스택 영역에 생성된다. 메서드에서 객체를 생성하는 코드가 있다면, 생성된 인스턴스의 참조값은 Stack에 할당이 되고 인스턴스는 Heap Area 영역에 할당이된다.

프로그램이 실행되는 동안에는 많은 객체들이 Heap Area에 할당 될 것이다. 메모리 자원은 한정적이므로 객체가 무한대로 할당될 순 없다. 더이상 사용되지 않는 영역은 할당을 해제해줄 필요가 있다. 이 역할을 바로 GC가 하는 것이다.

## Mark and Sweap
GC가 더이상 참조되지 않는 객체를 추적하는 전략이다. 스택의 모든 변수를 스캔하면서 어떤 객체를 참조하고 있는지 찾아서 마킹한다(Mark). 스캔이 끝나면 마킹되지 않은 객체를 Heap Area에서 제거한다(Sweap).

이렇게 단순하게 할당&해제 과정만 반복한다면 Heap 영역의 메모리 단편화를 야기할 수 있다.

프로세스(병행으로 주행하는 태스크)에 대한 기억 영역의 할당과 프로세스에 의한 기억 영역의 해방을 반복함으로써 작은 기억 영역의 분할부가 다수 생성되는 것. 사용할 수 있는 기억 공간이 프로세스가 요구하는 크기보다 작기 때문에 어떤 요구도 만족할 수 없고, 사용하지 않은 상태로 남아 있는 상태를 말한다.
[네이버 지식백과] 단편화 [fragmentation] (컴퓨터인터넷IT용어대사전, 2011. 1. 20., 전산용어사전편찬위원회)
GC는 메모리 단편화를 방지해가며 효율적으로 Heap 영역을 관리하기 위한 여러가지 CG 알고리즘이 있다.

## stop-the-world
> stop-the-world란, GC을 실행하기 위해 JVM이 애플리케이션 실행을 멈추는 것이다. stop-the-world가 발생하면 GC를 실행하는 쓰레드를 제외한 나머지 쓰레드는 모두 작업을 멈춘다.  
> GC 작업을 완료한 이후에야 중단했던 작업을 다시 시작한다.  
https://d2.naver.com/helloworld/1329

## Copying Collectors

inside-Java-Virtual-Machine
1–9번은 시간순으로 Heap 영역의 스냅샷이다.

Copying garbage collectors 는 Heap영역을 두 개로 나눈다.

1. 위쪽 영역의 메모리에만 할당이 된다. 회색은 할당된 구역을 나타낸다.
2. 아직 여유 공간이 있다.
3. 위쪽 영역의 메모리가 모두 할당되었다. JVM은 어플리케이션 실행을 멈추고 GC 실행한다.
4. GC가 객체를 스캔한다. 여전히 참조되고 있는 객체는 아래쪽 영역에 복사한다.
5. 복사가 완료되면 방금 아래쪽 영역에 할당된 모든 객체를 제거한다.
6. 어플리케이션 실행이 재게되면 이제는 아래쪽 영역에만 할당을 한다.
7. GC가 시작되고, 위쪽 영역에 객체를 복사한다.
8. 아래쪽 영역의 할당을 모두 해제한다.  

이렇게 두 영역을 번갈아가며 할당하고 해제하는 알고리즘이 Copying garbage collectors이다. 이 알고리즘의 단점이 있다. 참조되는 객체는 GC가 작업을 수행할 때마다 무조건 복사되어 반대편 영역에 할당되는 점이다.

## Generational Collectors
이 가비지 컬렉터는 두 가지 가설 하에 만들어졌다.

대부분의 객체는 금방 접근 불가능 상태(unreachable)가 된다.
오래된 객체에서 젊은 객체로의 참조는 아주 적게 존재한다.
이 가설에 비추어 Copying garbage collectors 의 전략을 되짚어 보면, 대부분의 객체가 금방 접근 불가능 상태가 될텐데 CG가 실행될 때마다 객체를 복사하는 건 비효율이다.

이런 단점을 보완하여 generational collectors는 짧게 생존하는 객체들 만을 대상으로 garbage collect 작업을 더욱 빈번하게 하는 방법이다.

>이러한 가설을 ‘weak generational hypothesis’라 한다.   
> 이 가설의 장점을 최대한 살리기 위해서 HotSpot VM에서는 크게 2개로 물리적 공간을 나누었다. 둘로 나눈 공간이 Young 영역과 Old 영역이다.  
>Young 영역(Yong Generation 영역): 새롭게 생성한 객체의 대부분이 여기에 위치한다. 
대부분의 객체가 금방 접근 불가능 상태가 되기 때문에 매우 많은 객체가 Young 영역에 생성되었다가 사라진다. 이 영역에서 객체가 사라질때 Minor GC가 발생한다고 말한다.  
>Old 영역(Old Generation 영역): 접근 불가능 상태로 되지 않아 Young 영역에서 살아남은 객체가 여기로 복사된다. 대부분 Young 영역보다 크게 할당하며, 크기가 큰 만큼 Young 영역보다 GC는 적게 발생한다.   
>이 영역에서 객체가 사라질 때 Major GC(혹은 Full GC)가 발생한다고 말한다.
> https://d2.naver.com/helloworld/1329

ㄹ

